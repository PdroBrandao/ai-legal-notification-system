Implementar um pipeline funcional no WhatsApp para que advogados consultem suas intimações de forma automatizada, utilizando GPT para refinar a interação em linguagem natural e Prisma para consulta ao banco, entregando uma resposta clara e útil ao usuário.

Fluxo resumido
1️⃣ Usuário envia mensagem no WhatsApp:

“Tem intimação pra mim hoje?”
“Quais intimações tenho do cliente João esta semana?”
“Quando é a audiência do processo 0011222-10.2024.5.03.0100?”

2️⃣ A Lambda (Webhook do WhatsApp):

Recebe a mensagem.

Verifica se a mensagem contém:

advogadoId (será buscado no token/session ou cache).

Data (hoje, amanhã, semana que vem) ou outras entidades.

3️⃣ Uso do GPT:

Extrai entidades e intenções caso a pergunta seja mais aberta.

Identifica:
Tipo de consulta (intimações do dia, semana, processo específico, etc.).
Datas em formato YYYY-MM-DD.

4️⃣ Consulta ao banco usando Prisma:

Realiza query ao banco conforme advogadoId e filtros extraídos:

Data específica ou range.

Processo específico.

Status (PENDENTE, etc.).

5️⃣ Geração da resposta:

Com o retorno da query, opcionalmente envia ao GPT para formatar em linguagem natural amigável, ex:

“Hoje você tem 2 intimações: uma audiência no processo X e uma intimação para tomar ciência no processo Y.”

6️⃣ Envio da resposta via WhatsApp para o usuário.

Funcionalidades previstas nesta etapa
✅ Uso de fallback:

Se o usuário perguntar algo fora do escopo:

“Ainda não consigo responder a isso, mas em breve vou aprender!”

✅ Log dos retornos para análises futuras.

✅ Modularização limpa:

getNotificationsForLawyer()

formatNotificationResponse()

extractEntitiesWithGPT() (opcional, conforme necessário)

✅ Preparado para evoluir para:

Suporte a perguntas livres com MCP Toolbox no futuro.

Versionamento de prompts e testes regressivos de retorno.


